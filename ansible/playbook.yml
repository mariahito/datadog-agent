- name: Terraform Init & Apply
        id: terraform
        working-directory: ./terraform
        run: |
          terraform init
          # Added -input=false and -no-color to prevent formatting issues
          terraform apply -auto-approve -input=false -no-color
          
          # Capture IPs into variables to ensure clean strings
          DEV_IP=$(terraform output -raw -no-color dev_ip)
          TEST_IP=$(terraform output -raw -no-color test_ip)
          PROD_IP=$(terraform output -raw -no-color prod_ip)
          
          # Debugging: Print the IPs to the GitHub Console
          echo "Captured IPs -> Dev: $DEV_IP | Test: $TEST_IP | Prod: $PROD_IP"
          
          # Create the inventory file safely
          echo "[dev]" > ../inventory.ini
          echo "$DEV_IP env_tag=dev" >> ../inventory.ini
          
          echo "[test]" >> ../inventory.ini
          echo "$TEST_IP env_tag=test" >> ../inventory.ini
          
          echo "[prod]" >> ../inventory.ini
          echo "$PROD_IP env_tag=prod" >> ../inventory.ini
          
          # CRITICAL: Print the final file to logs for debugging
          echo "--- INVENTORY CONTENT START ---"
          cat ../inventory.ini
          echo "--- INVENTORY CONTENT END ---"
